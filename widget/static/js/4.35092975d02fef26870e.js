webpackJsonp([4,35],{ECoy:function(t,e){},HVFi:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("Dd8w"),n=s.n(i),a=s("tyqc"),r=s("o7NV"),o=s("NYxO"),c={components:{Header:a.a,MessageBox:r.default},mounted:function(){localStorage.setItem("chatname",this.username)},computed:{chatList:function(){return this.$store.state.chat.msgList},isShowFriendRequest:function(){return this.$store.state.friendModule.friendRequest.isShow},username:function(){return this.$route.query.username}},data:function(){return{type:"contact",userphone:"",ishow:!1,isaddGroup:!1,form:{groName:"",desc:"",radio:"2",radiopom:"2",membersList:[]},root:"http://192.168.43.129:8080/"}},methods:n()({},Object(o.b)(["onLogout","onGetFirendBlack","onGetContactUserList","addfirend","acceptSubscribe","declineSubscribe","acceptSubscribe","declineSubscribe","onCreateGroup","getFriends"]),{toFriendList:function(){this.type="contact",this.$router.push("/chat/contact?username="+localStorage.getItem("chatname"))},toGroupList:function(){this.type="group",this.$router.push("/chat/group?username="+localStorage.getItem("chatname"))},getUnreadNum:function(t){var e=this.$route,s=e.name;e.params;console.log(this.chatList);var i=this.chatList[s],n="";if("contact"==s)n=t.name;else{if("group"!=s)return n=t.id,0;n=t.groupid}var a=0;return(i[n]||[]).forEach(function(t){"read"===t.status||"recall"===t.status||t.bySelf||a++}),a},changeModal:function(){this.$store.state.friendModule.friendRequest.isShow=!this.$store.state.friendModule.friendRequest.isShow},addFriends:function(){var t=this;this.ishow=!1;mui.prompt("请输入对方手机号码：","","添加好友",["取消","确定"],function(e){if(1==e.index){var s={id:e.value,params:t.$route.query.username};t.addfirend(s),mui.toast("已发送请求")}})},refusedClick:function(){var t={id:this.$store.state.friendModule.friendRequest.from,params:this.$route.query.username};this.declineSubscribe(t),this.changeModal()},acceptSubmit:function(){var t=this.$store.state.friendModule.friendRequest.from;this.acceptSubscribe(t),this.insertFriend(t),this.changeModal()},insertFriend:function(t){var e=this;this.$ajax.post({url:this.root+"chat/insertFriend",data:{fromuser:this.username,touser:t}}).then(function(t){t.status&&e.getFriends()})},dialog:function(){this.ishow=!this.ishow},addGroup:function(){var t=this;this.ishow=!1;mui.prompt("请输入群名：","","创建群组",["取消","确定"],function(e){1==e.index&&(t.form.groName=e.value,t.postCreateGroup(),mui.toast("正在创建"))})},postCreateGroup:function(){this.onCreateGroup({groupname:this.form.groName,desc:this.form.desc,members:this.form.membersList,approval:2==this.form.radiopom,pub:2==this.form.radio})},goback:function(){"1"===this.$cookies.get("CUR_USERINFO").status?this.$router.push("/admin/home"):this.$router.push("/home")}})},u={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content-container"},[s("div",{staticClass:"back-header"},[s("span",{staticClass:"mui-icon mui-icon-arrowleft",on:{click:function(e){return t.goback()}}}),t._v(" "),s("span",[t._v("\n          聊天\n      ")]),t._v(" "),s("span",{staticClass:"mui-icon mui-icon-plus",on:{click:function(e){return t.dialog()}}})]),t._v(" "),t.ishow?s("div",{staticClass:"dialog-container"},[t._m(0),t._v(" "),s("div",{staticClass:"top-dialog fadeInDown"},[s("ul",{staticClass:"dialog-li"},[s("li",{on:{click:function(e){return t.addFriends()}}},[s("span",{staticClass:"mui-icon mui-icon-personadd"}),t._v("\n            添加好友\n          ")]),t._v(" "),s("li",{on:{click:function(e){return t.addGroup()}}},[s("span",{staticClass:"mui-icon mui-icon-chatboxes"}),t._v("\n            创建群组\n          ")])])])]):t._e(),t._v(" "),s("div",{staticClass:"mui-content"},[s("div",{staticClass:"mui-segmented-control",attrs:{id:"segmentedControl"}},[s("div",{staticClass:"icon-container mui-control-item  mui-active",on:{click:function(e){return t.toFriendList()}}},[s("span",{staticClass:"iconfont icon-wode"}),t._v(" "),s("a",[t._v("好友 ")])]),t._v(" "),s("div",{staticClass:"icon-container  mui-control-item",on:{click:function(e){return t.toGroupList()}}},[s("span",{staticClass:"iconfont icon-yonghu1"}),t._v(" "),s("a",[t._v("聊天室")])])]),t._v(" "),s("router-view",{staticClass:"router"},[s("router-link")],1)],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:this.isShowFriendRequest,expression:"this.isShowFriendRequest"}],staticClass:"mui-popup mui-popup-in",staticStyle:{display:"block"}},[s("div",{staticClass:"mui-popup-inner"},[s("div",{staticClass:"mui-popup-title"},[t._v("好友请求")]),t._v(" "),s("div",{staticClass:"mui-popup-text"},[t._v(t._s(this.$store.state.friendModule.friendRequest.status))])]),t._v(" "),s("div",{staticClass:"mui-popup-buttons"},[s("span",{staticClass:"mui-popup-button",attrs:{type:"primary"},on:{click:t.acceptSubmit}},[t._v("同意")]),t._v(" "),s("span",{staticClass:"mui-popup-button mui-popup-button-bold",on:{click:t.refusedClick}},[t._v("拒绝")])])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"triangle-container"},[e("div",{staticClass:"triangle"})])}]};var d=s("VU/8")(c,u,!1,function(t){s("ECoy")},"data-v-b7f17dc8",null);e.default=d.exports},Sivn:function(t,e){},o7NV:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("Dd8w"),n=s.n(i),a=s("Xxa5"),r=s.n(a),o=s("exGp"),c=s.n(o),u=s("NYxO"),d=s("PJh5"),l=s.n(d),m={components:{Nothing:s("+pfy").a},mounted:function(){var t=this;return c()(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.onGetContactUserList(),e.next=3,t.getFriends();case 3:console.log(t.friendList);case 4:case"end":return e.stop()}},e,t)}))()},computed:n()({},Object(u.c)({contact:"onGetContactUserList",msgList:"onGetCurrentChatObjMsg",friendList:"friends"}),{userList:function(){return{contact:this.contact.filter(function(t){if(t)return t}),group:this.group,chatroom:this.chatroom}},chatList:function(){return this.$store.state.chat.msgList},getKey:function(t){var e="";switch(this.type){case"contact":e=t.name;break;case"group":e=t.groupid;break;case"chatroom":e=t.id}return e},username:function(){return this.$route.query.username}}),data:function(){return{root:"http://192.168.43.129:8080/",friends:[]}},props:["type"],methods:n()({},Object(u.b)(["onLogout","onGetFirendBlack","onGetContactUserList","getFriends"]),{renderTime:function(t){var e=new Date,s=t?new Date(t):e;return l()(s).format("MM-DD hh:mm A")},getLastMsg:function(t){var e=this.chatList.contact[t.touser]||[],s="",i=e.length&&e[e.length-1].type;return e.length&&(s="img"===i?"[image]":"file"===i?e[e.length-1].filename:"audio"===i?"[audio]":"vidio"===i?"[vidio]":e[e.length-1].msg),{lastMsg:s,msgTime:e.length?this.renderTime(e[e.length-1].time):""}},select2:function(t){this.$router.push("/chat/message/"+t.touser+"/"+this.username+"/"+t.username)},getUnreadNum:function(t){var e=this.$route,s=(e.name,e.params,0);return(this.chatList.contact[t.touser]||[]).forEach(function(t){"read"===t.status||"recall"===t.status||t.bySelf||s++}),s},init:function(){var t=this;this.$ajax.post({url:this.root+"chat/selectFriends",data:{userphone:this.username}}).then(function(e){e.status&&(t.friends=e.result)})}}),filters:{avatar:function(t){return t.charAt(t.length-1)}}},h={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"messagebox-container"},[t.userList.contact.length?t._e():s("Nothing"),t._v(" "),t._l(t.friendList,function(e){return s("div",{staticClass:"item",on:{click:function(s){return t.select2(e)}}},[e.avatar?t._e():s("div",{staticClass:"avatar"},[s("span",{staticClass:"avatar-span"},[t._v(t._s(t._f("avatar")(e.username)))])]),t._v(" "),e.avatar?s("img",{staticClass:"avatar",attrs:{src:e.avatar}}):t._e(),t._v(" "),s("div",{staticClass:"message-container"},[s("div",{staticClass:"message-info"},[s("div",[s("span",{staticClass:"message-name"},[t._v(t._s(e.username))]),t._v(" "),0!=t.getUnreadNum(e)?s("div",{staticClass:"icon-style"},[s("span",{staticClass:"unreadNum"},[t._v(t._s(t.getUnreadNum(e)))])]):t._e()]),t._v(" "),s("span",{staticClass:"time-style"},[t._v(t._s(t.getLastMsg(e).msgTime))])]),t._v(" "),s("div",{staticClass:"message-detail"},[t._v(t._s(t.getLastMsg(e).lastMsg))])])])})],2)},staticRenderFns:[]};var p=s("VU/8")(m,h,!1,function(t){s("Sivn")},"data-v-5bb79407",null);e.default=p.exports}});
//# sourceMappingURL=4.35092975d02fef26870e.js.map