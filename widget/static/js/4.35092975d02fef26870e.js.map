{"version":3,"sources":["webpack:///src/views/chat/index.vue","webpack:///./src/views/chat/index.vue?981f","webpack:///./src/views/chat/index.vue","webpack:///src/views/chat/messagebox.vue","webpack:///./src/views/chat/messagebox.vue?ca7a","webpack:///./src/views/chat/messagebox.vue"],"names":["chat","components","Header","LeftHeader","MessageBox","messagebox","mounted","localStorage","setItem","this","username","computed","chatList","$store","state","msgList","isShowFriendRequest","friendModule","friendRequest","isShow","$route","query","data","type","userphone","ishow","isaddGroup","form","groName","desc","radio","radiopom","membersList","root","methods","extends_default","Object","vuex_esm","toFriendList","$router","push","getItem","toGroupList","getUnreadNum","item","_$route","name","params","console","log","userId","id","groupid","unReadNum","forEach","msg","status","bySelf","changeModal","addFriends","_this","mui","prompt","e","index","option","value","addfirend","toast","refusedClick","options","from","declineSubscribe","acceptSubmit","acceptSubscribe","insertFriend","_this2","$ajax","post","url","fromuser","touser","then","result","getFriends","dialog","addGroup","_this3","postCreateGroup","onCreateGroup","groupname","members","approval","pub","goback","$cookies","get","views_chat","render","_vm","_h","$createElement","_c","_self","staticClass","on","click","$event","_v","_m","_e","attrs","directives","rawName","expression","staticStyle","display","_s","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__","Nothing","asyncToGenerator_default","regenerator_default","a","mark","_callee","wrap","_context","prev","next","onGetContactUserList","friendList","stop","contact","userList","filter","group","chatroom","getKey","key","friends","props","renderTime","time","nowStr","Date","localStr","moment_default","format","getLastMsg","currentMsgs","lastMsg","lastType","length","filename","msgTime","select2","init","filters","avatar","charAt","chat_messagebox","_l","_f","src"],"mappings":"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","file":"static/js/4.35092975d02fef26870e.js","sourcesContent":["<template>\r\n    <div class=\"content-container\">\r\n        <!-- <Header>聊天</Header> -->\r\n        <div class=\"back-header\">\r\n          <span @click=\"goback()\" class=\"mui-icon mui-icon-arrowleft\"></span>\r\n          <span>\r\n              聊天\r\n          </span>\r\n          <span class=\"mui-icon mui-icon-plus\" @click=\"dialog()\"></span>\r\n        </div>\r\n        <!-- <span class=\"mui-icon mui-icon-plus\" @click=\"dialog()\"></span> -->\r\n        <div v-if=\"ishow\" class=\"dialog-container\">\r\n          <div class=\"triangle-container\">\r\n            <div class=\"triangle\"></div>\r\n          </div>\r\n          <div  class=\"top-dialog fadeInDown\">\r\n            <ul class=\"dialog-li\">\r\n              <li @click=\"addFriends()\">\r\n                <span class=\"mui-icon mui-icon-personadd\"></span>\r\n                添加好友\r\n              </li>\r\n              <li  @click=\"addGroup()\">\r\n                <span class=\"mui-icon mui-icon-chatboxes\"></span>\r\n                创建群组\r\n              </li>\r\n            </ul>\r\n          </div>\r\n        </div>\r\n        <div class=\"mui-content\">\r\n                <div id=\"segmentedControl\" class=\"mui-segmented-control\">\r\n                  <div @click=\"toFriendList()\" class=\"icon-container mui-control-item  mui-active\">\r\n                    <span class=\"iconfont icon-wode\"></span>\r\n                    <a  >好友 </a>\r\n                  </div>\r\n                  <div @click=\"toGroupList()\" class=\"icon-container  mui-control-item\">\r\n                    <span class=\"iconfont icon-yonghu1\"></span>\r\n                    <a >聊天室</a>\r\n                  </div>\r\n                </div>\r\n            <router-view class=\"router\">\r\n                <router-link></router-link>\r\n            </router-view>\r\n            <!-- <div>\r\n                <div id=\"item2\" class=\"mui-control-content\">\r\n                      <MessageBox :type=type v-if=\"type==='contact'\" ref=\"messageBox\"></MessageBox>\r\n                </div>\r\n                <div id=\"item3\" class=\"mui-control-content\">\r\n                    <ul v-if=\"type==='group'\" class=\"mui-table-view\">\r\n                        <li class=\"mui-table-view-cell\">\r\n                            第三个选项卡子项-1\r\n                        </li>\r\n                        <li class=\"mui-table-view-cell\">\r\n                            第三个选项卡子项-2\r\n                        </li>\r\n                        <li class=\"mui-table-view-cell\">\r\n                            第三个选项卡子项-3\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n            </div> -->\r\n        </div>\r\n        <div  v-show=\"this.isShowFriendRequest\" class=\"mui-popup mui-popup-in\" style=\"display: block;\">\r\n          <div class=\"mui-popup-inner\">\r\n            <div class=\"mui-popup-title\">好友请求</div>\r\n            <div class=\"mui-popup-text\">{{this.$store.state.friendModule.friendRequest.status}}</div>\r\n          </div>\r\n          <div class=\"mui-popup-buttons\">\r\n            <span @click=\"acceptSubmit\" class=\"mui-popup-button\" type=\"primary\">同意</span>\r\n            <span @click=\"refusedClick\" class=\"mui-popup-button mui-popup-button-bold\">拒绝</span>\r\n          </div>\r\n        </div>\r\n        <!-- <div class=\"mui-popup mui-popup-in\" style=\"display: block;\">\r\n          <div class=\"mui-popup-inner\">\r\n            <div class=\"mui-popup-title\">创建群组</div>\r\n            <div class=\"mui-popup-text\">请输入对方手机号码：</div>\r\n            <div class=\"mui-popup-input\">\r\n              <input type=\"text\" autofocus=\"\" placeholder=\"\">\r\n            </div>\r\n          </div>\r\n          <div class=\"mui-popup-buttons\">\r\n            <span class=\"mui-popup-button\">取消</span>\r\n            <span class=\"mui-popup-button mui-popup-button-bold\">确定</span>\r\n          </div>\r\n        </div> -->\r\n    </div>\r\n</template>\r\n<script>\r\nimport Header from '../../components/LeftHeader'\r\nimport MessageBox from './messagebox'\r\nimport { mapState, mapActions } from 'vuex'\r\nexport default {\r\n  components: {Header, MessageBox},\r\n  mounted () {\r\n    localStorage.setItem('chatname', this.username)\r\n  },\r\n  computed: {\r\n    chatList () {\r\n      return this.$store.state.chat.msgList\r\n    },\r\n    isShowFriendRequest () {\r\n      return this.$store.state.friendModule.friendRequest.isShow\r\n    },\r\n    username () {\r\n      return this.$route.query.username\r\n    }\r\n  },\r\n  data () {\r\n    return {\r\n      type: 'contact',\r\n      userphone: '',\r\n      ishow: false,\r\n      isaddGroup: false,\r\n      form: {\r\n        groName: '',\r\n        desc: '',\r\n        radio: '2',\r\n        radiopom: '2',\r\n        membersList: []\r\n      },\r\n      root: process.env.API_HOST\r\n    }\r\n  },\r\n  methods: {\r\n    ...mapActions([\r\n      'onLogout',\r\n      'onGetFirendBlack',\r\n      'onGetContactUserList',\r\n      'addfirend',\r\n      'acceptSubscribe',\r\n      'declineSubscribe',\r\n      'acceptSubscribe',\r\n      'declineSubscribe',\r\n      'onCreateGroup',\r\n      'getFriends'\r\n    ]),\r\n    toFriendList () {\r\n    //   this.$refs.messageBox.onGetContactUserList()\r\n      this.type = 'contact'\r\n      this.$router.push(`/chat/contact?username=${localStorage.getItem('chatname')}`)\r\n    },\r\n    toGroupList () {\r\n      this.type = 'group'\r\n      this.$router.push(`/chat/group?username=${localStorage.getItem('chatname')}`)\r\n    },\r\n    getUnreadNum (item) {\r\n      const { name, params } = this.$route;\r\n      console.log(this.chatList)\r\n      const chatList = this.chatList[name]\r\n      let userId = \"\";\r\n      if (name == \"contact\") {\r\n        userId = item.name;\r\n      } else if (name == \"group\") {\r\n        userId = item.groupid;\r\n      } else {\r\n        userId = item.id;\r\n        return 0;\r\n      }\r\n      const currentMsgs = chatList[userId] || [];\r\n      let unReadNum = 0;\r\n      currentMsgs.forEach(msg => {\r\n        if (msg.status !== \"read\" && msg.status !== \"recall\" && !msg.bySelf) {\r\n          unReadNum++;\r\n        }\r\n      });\r\n      return unReadNum;\r\n    },\r\n    changeModal () {\r\n      this.$store.state.friendModule.friendRequest.isShow = !this.$store.state\r\n        .friendModule.friendRequest.isShow\r\n    },\r\n    addFriends () {\r\n      this.ishow = false\r\n      var btnArray = ['取消', '确定']\r\n      mui.prompt('请输入对方手机号码：', '', '添加好友', btnArray, (e) => {\r\n        if (e.index == 1) {\r\n          const option = {\r\n            id: e.value,\r\n            params: this.$route.query.username\r\n          };\r\n          this.addfirend(option)\r\n          mui.toast('已发送请求')\r\n        } else {\r\n        //   info.innerText = '你点了取消按钮'\r\n        }\r\n      })\r\n    },\r\n    refusedClick () {\r\n      const options = {\r\n        id: this.$store.state.friendModule.friendRequest.from,\r\n        params: this.$route.query.username\r\n      }\r\n      this.declineSubscribe(options)\r\n      this.changeModal()\r\n    },\r\n    acceptSubmit () {\r\n      const id = this.$store.state.friendModule.friendRequest.from\r\n      this.acceptSubscribe(id)\r\n      this.insertFriend(id)\r\n      this.changeModal()\r\n    },\r\n    insertFriend (id) {\r\n      this.$ajax.post({\r\n        url: this.root + 'chat/insertFriend',\r\n        data: {\r\n          fromuser: this.username,\r\n          touser:id\r\n        }\r\n      }).then(result => {\r\n        if (result.status) {\r\n          this.getFriends()\r\n        } else {\r\n        }\r\n      })\r\n    },\r\n    dialog () {\r\n      this.ishow = !this.ishow\r\n    },\r\n    addGroup () {\r\n      this.ishow = false\r\n      var btnArray = ['取消', '确定']\r\n      mui.prompt('请输入群名：', '', '创建群组', btnArray, (e) => {\r\n        if (e.index == 1) {\r\n          this.form.groName = e.value \r\n          this.postCreateGroup()\r\n          mui.toast('正在创建')\r\n        }\r\n      })\r\n    },\r\n    postCreateGroup () {\r\n      this.onCreateGroup({\r\n        groupname: this.form.groName,\r\n        desc: this.form.desc,\r\n        members: this.form.membersList,\r\n        approval: this.form.radiopom == 2,\r\n        pub: this.form.radio == 2\r\n      })\r\n    },\r\n    goback () {\r\n      if (this.$cookies.get('CUR_USERINFO').status === '1') {\r\n        this.$router.push('/admin/home')\r\n      } else {\r\n        this.$router.push('/home')\r\n      }\r\n      \r\n    }\r\n  }\r\n}\r\n</script>\r\n<style scoped>\r\n.body{\r\n  height: auto;\r\n}\r\n.content-container{\r\n    background-color: none;\r\n    background: none;\r\n}\r\n.mui-content {\r\n    margin-top: 40px;\r\n    height: 100%;\r\n}\r\n\r\n.icon-container{\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  border-right: none;\r\n}\r\n.iconfont{\r\n  margin-right: 10px;\r\n}\r\n.mui-segmented-control{\r\n  display: flex;\r\n  border: none;\r\n  border-bottom: 2px white solid;\r\n  position: fixed;\r\n  z-index: 998;\r\n  top: 40px;\r\n  border-top: 1px whitesmoke solid;\r\n  background: #EFEFF4;\r\n  height: 40px;\r\n}\r\n.mui-segmented-control .mui-control-item.mui-active{\r\n    background: none !important;\r\n    color: #6e8b3d;\r\n    border: none;\r\n    font-weight: bold;\r\n    border-bottom: 2px #6e8b3d solid;\r\n}\r\n.mui-segmented-control .mui-control-item.mui-active>a{\r\n  color: #6e8b3d;\r\n}\r\n.mui-control-item{\r\n  border: none;\r\n}\r\n.mui-icon-plus{\r\n  position: fixed;\r\n  top: 10px;\r\n  color: black;\r\n  right: 5px;\r\n  z-index: 999;\r\n  font-size: 18px;\r\n  font-weight: bold;\r\n}\r\n.top-dialog{\r\n  width: 150px;\r\n  height: 80px;\r\n  background-color: whitesmoke;\r\n  border-radius: 10px;\r\n}\r\n.dialog-li>li{\r\n  height: 40px;\r\n  line-height: 40px;\r\n  text-align: center;\r\n}\r\n.dialog-li>li:nth-child(1){\r\n  border-bottom: 1px lightgray solid;\r\n}\r\n.triangle{\r\n  width: 0;\r\n  height: 0;\r\n  border: 6px whitesmoke solid;\r\n  border-top: none;\r\n  border-left-color: transparent;\r\n  border-right-color: transparent;\r\n  margin-right: 5px;\r\n}\r\n.triangle-container{\r\n  display: flex;\r\n  justify-content: flex-end;\r\n\r\n}\r\n.dialog-container{\r\n  top: 30px;\r\n  right: 5px;\r\n  position: fixed;\r\n  z-index: 1000;\r\n}\r\n.mui-input-group{\r\n  position: absolute;\r\n}\r\n</style>\r\n\r\n.mui-segmented-control{\r\n    /* border: 1px #6e8b3d solid; */\r\n    border: none;\r\n    display: flex;\r\n    justify-content: space-around;\r\n    width: 100%;\r\n}\r\n.mui-segmented-control .mui-control-item{\r\n    border: #6e8b3d;\r\n    color: black;\r\n}\r\n.mui-segmented-control a{\r\n    display: block;\r\n    flex: 1;\r\n}\n\n\n// WEBPACK FOOTER //\n// src/views/chat/index.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"content-container\"},[_c('div',{staticClass:\"back-header\"},[_c('span',{staticClass:\"mui-icon mui-icon-arrowleft\",on:{\"click\":function($event){return _vm.goback()}}}),_vm._v(\" \"),_c('span',[_vm._v(\"\\n          聊天\\n      \")]),_vm._v(\" \"),_c('span',{staticClass:\"mui-icon mui-icon-plus\",on:{\"click\":function($event){return _vm.dialog()}}})]),_vm._v(\" \"),(_vm.ishow)?_c('div',{staticClass:\"dialog-container\"},[_vm._m(0),_vm._v(\" \"),_c('div',{staticClass:\"top-dialog fadeInDown\"},[_c('ul',{staticClass:\"dialog-li\"},[_c('li',{on:{\"click\":function($event){return _vm.addFriends()}}},[_c('span',{staticClass:\"mui-icon mui-icon-personadd\"}),_vm._v(\"\\n            添加好友\\n          \")]),_vm._v(\" \"),_c('li',{on:{\"click\":function($event){return _vm.addGroup()}}},[_c('span',{staticClass:\"mui-icon mui-icon-chatboxes\"}),_vm._v(\"\\n            创建群组\\n          \")])])])]):_vm._e(),_vm._v(\" \"),_c('div',{staticClass:\"mui-content\"},[_c('div',{staticClass:\"mui-segmented-control\",attrs:{\"id\":\"segmentedControl\"}},[_c('div',{staticClass:\"icon-container mui-control-item  mui-active\",on:{\"click\":function($event){return _vm.toFriendList()}}},[_c('span',{staticClass:\"iconfont icon-wode\"}),_vm._v(\" \"),_c('a',[_vm._v(\"好友 \")])]),_vm._v(\" \"),_c('div',{staticClass:\"icon-container  mui-control-item\",on:{\"click\":function($event){return _vm.toGroupList()}}},[_c('span',{staticClass:\"iconfont icon-yonghu1\"}),_vm._v(\" \"),_c('a',[_vm._v(\"聊天室\")])])]),_vm._v(\" \"),_c('router-view',{staticClass:\"router\"},[_c('router-link')],1)],1),_vm._v(\" \"),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(this.isShowFriendRequest),expression:\"this.isShowFriendRequest\"}],staticClass:\"mui-popup mui-popup-in\",staticStyle:{\"display\":\"block\"}},[_c('div',{staticClass:\"mui-popup-inner\"},[_c('div',{staticClass:\"mui-popup-title\"},[_vm._v(\"好友请求\")]),_vm._v(\" \"),_c('div',{staticClass:\"mui-popup-text\"},[_vm._v(_vm._s(this.$store.state.friendModule.friendRequest.status))])]),_vm._v(\" \"),_c('div',{staticClass:\"mui-popup-buttons\"},[_c('span',{staticClass:\"mui-popup-button\",attrs:{\"type\":\"primary\"},on:{\"click\":_vm.acceptSubmit}},[_vm._v(\"同意\")]),_vm._v(\" \"),_c('span',{staticClass:\"mui-popup-button mui-popup-button-bold\",on:{\"click\":_vm.refusedClick}},[_vm._v(\"拒绝\")])])])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"triangle-container\"},[_c('div',{staticClass:\"triangle\"})])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-b7f17dc8\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/chat/index.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-b7f17dc8\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./index.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./index.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./index.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-b7f17dc8\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./index.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-b7f17dc8\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/chat/index.vue\n// module id = null\n// module chunks = ","<template>\r\n<div class=\"messagebox-container\">\r\n  <Nothing v-if=\"!userList['contact'].length\"></Nothing>\r\n  <div\r\n    class=\"item\"\r\n    v-for=\"(item) in friendList\"\r\n    @click=\"select2(item)\">\r\n    <div  v-if=\"!item.avatar\" class=\"avatar\">\r\n      <span class=\"avatar-span\">{{item.username|avatar}}</span>\r\n    </div>\r\n    <img class=\"avatar\" v-if=\"item.avatar\" :src=\"item.avatar\"/>\r\n    <div class=\"message-container\">\r\n      <div class=\"message-info\">\r\n        <div>\r\n          <!-- <span class=\"message-name\">{{item.name}}</span> -->\r\n          <span class=\"message-name\">{{item.username}}</span>\r\n          <div class=\"icon-style\" v-if=\"getUnreadNum(item) != 0\">\r\n            <span class=\"unreadNum\">{{getUnreadNum(item)}}</span>\r\n          </div>\r\n        </div>\r\n        <span class=\"time-style\">{{getLastMsg(item).msgTime}}</span>\r\n      </div>\r\n      <div class=\"message-detail\">{{getLastMsg(item).lastMsg}}</div>\r\n    </div>\r\n  </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { mapState, mapActions,mapGetters } from 'vuex'\r\nimport moment from 'moment'\r\nimport Nothing from '../../components/nothing'\r\nexport default {\r\n  components: { Nothing },\r\n  async mounted () {\r\n    this.onGetContactUserList()\r\n    await this.getFriends()\r\n    // this.init()\r\n    console.log(this.friendList)\r\n  },\r\n  computed: {\r\n    ...mapGetters({\r\n      contact: 'onGetContactUserList',\r\n      msgList: 'onGetCurrentChatObjMsg',\r\n      friendList: 'friends'\r\n    // group: \"onGetGroupUserList\",\r\n    // chatroom: \"onGetChatroomUserList\",\r\n    }),\r\n    userList () {\r\n      return {\r\n        contact: this.contact.filter(item => {\r\n          if (item) {\r\n            return item\r\n          }\r\n        }),\r\n        group: this.group,\r\n        chatroom: this.chatroom\r\n      }\r\n    },\r\n    chatList () {\r\n      return this.$store.state.chat.msgList\r\n    },\r\n    getKey (item) {\r\n      let key = \"\"\r\n      switch (this.type) {\r\n        case 'contact':\r\n          key = item.name\r\n          break\r\n        case 'group':\r\n          key = item.groupid\r\n          break\r\n        case 'chatroom':\r\n          key = item.id\r\n          break\r\n        default:\r\n          break\r\n      }\r\n      return key;\r\n    },\r\n    username () {\r\n      return this.$route.query.username\r\n    }\r\n  },\r\n  data () {\r\n    return {\r\n      root: process.env.API_HOST,\r\n      friends: []\r\n    }\r\n  },\r\n  props: [\r\n    'type' // 聊天类型 contact, group, chatroom\r\n  ],\r\n  methods: {\r\n    ...mapActions(['onLogout', 'onGetFirendBlack', 'onGetContactUserList', 'getFriends']),\r\n    renderTime (time) {\r\n      const nowStr = new Date()\r\n      const localStr = time ? new Date(time) : nowStr\r\n      const localMoment = moment(localStr)\r\n      const localFormat = localMoment.format('MM-DD hh:mm A')\r\n      return localFormat\r\n    },\r\n    getLastMsg (item) {\r\n      // let { name, params } = this.$route;\r\n      let  name = 'contact'\r\n      const chatList = this.chatList[name]\r\n      const userId = item.touser\r\n      const currentMsgs = chatList[userId] || []\r\n      let lastMsg = ''\r\n      let lastType =\r\n        currentMsgs.length && currentMsgs[currentMsgs.length - 1].type\r\n      if (currentMsgs.length) {\r\n        if (lastType === 'img') {\r\n          lastMsg = '[image]'\r\n        } else if (lastType === 'file') {\r\n          lastMsg = currentMsgs[currentMsgs.length - 1].filename\r\n        } else if (lastType === 'audio') {\r\n          lastMsg = '[audio]'\r\n        } else if (lastType === 'vidio') {\r\n          lastMsg = '[vidio]'\r\n        } else {\r\n          lastMsg = currentMsgs[currentMsgs.length - 1].msg\r\n        }\r\n      }\r\n      const msgTime = currentMsgs.length\r\n        ? this.renderTime(currentMsgs[currentMsgs.length - 1].time)\r\n        : \"\"\r\n      return {\r\n        lastMsg,\r\n        msgTime\r\n      }\r\n    },\r\n    select2 (item) {\r\n      // this.$router.push(`/chat/message/${item.name}/${this.username}`)\r\n      this.$router.push(`/chat/message/${item.touser}/${this.username}/${item.username}`)\r\n    },\r\n    getUnreadNum (item) {\r\n      const { name, params } = this.$route\r\n      const chatList = this.chatList['contact']\r\n      let userId = item.touser\r\n      const currentMsgs = chatList[userId] || []\r\n      let unReadNum = 0\r\n      currentMsgs.forEach(msg => {\r\n        if (msg.status !== \"read\" && msg.status !== \"recall\" && !msg.bySelf) {\r\n          unReadNum++;\r\n        }\r\n      });\r\n      return unReadNum\r\n    },\r\n    init () {\r\n      this.$ajax.post({\r\n        url: this.root + 'chat/selectFriends',\r\n        data: {\r\n          userphone: this.username\r\n        }\r\n      }).then(result => {\r\n        if (result.status) {\r\n          this.friends = result.result\r\n        } else {\r\n        }\r\n      })\r\n    }\r\n  },\r\n  filters: {\r\n    avatar (name) {\r\n      return name.charAt(name.length - 1)\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style scoped>\r\n.messagebox-container{\r\n  margin-top: 80px;\r\n  height: 100%;\r\n}\r\n.item {\r\n  height: 70px;\r\n  border-bottom: 1px lightgray solid;\r\n  display: flex;\r\n  align-items: center;\r\n  background: white;\r\n}\r\n.avatar{\r\n  width: 50px;\r\n  height: 50px;\r\n  background-color: #3396FB;\r\n  border-radius: 50%;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  margin-left: 10px;\r\n}\r\n.avatar-span{\r\n  color: white;\r\n  font-weight: bold;\r\n}\r\n.message-info{\r\n  display: flex;\r\n  justify-content: space-between;\r\n  padding: 0 10px;\r\n  width: 100%;\r\n}\r\n.message-container{\r\n  width: 80%;\r\n  height: 40px;\r\n  overflow: hidden;\r\n}\r\n.message-detail{\r\n  margin-left: 10px;\r\n  mask-type: 10px;\r\n  opacity: 0.6;\r\n}\r\n.message-name{\r\n  font-size: 16px;\r\n  \r\n}\r\n.icon-style {\r\n  display: inline-block;\r\n  background-color: #f04134;\r\n  width: 20px;\r\n  height: 20px;\r\n  border-radius: 50%;\r\n  color: white;\r\n  line-height: 1.5;\r\n  text-align: center;\r\n}\r\n\r\n</style>\n\n\n// WEBPACK FOOTER //\n// src/views/chat/messagebox.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"messagebox-container\"},[(!_vm.userList['contact'].length)?_c('Nothing'):_vm._e(),_vm._v(\" \"),_vm._l((_vm.friendList),function(item){return _c('div',{staticClass:\"item\",on:{\"click\":function($event){return _vm.select2(item)}}},[(!item.avatar)?_c('div',{staticClass:\"avatar\"},[_c('span',{staticClass:\"avatar-span\"},[_vm._v(_vm._s(_vm._f(\"avatar\")(item.username)))])]):_vm._e(),_vm._v(\" \"),(item.avatar)?_c('img',{staticClass:\"avatar\",attrs:{\"src\":item.avatar}}):_vm._e(),_vm._v(\" \"),_c('div',{staticClass:\"message-container\"},[_c('div',{staticClass:\"message-info\"},[_c('div',[_c('span',{staticClass:\"message-name\"},[_vm._v(_vm._s(item.username))]),_vm._v(\" \"),(_vm.getUnreadNum(item) != 0)?_c('div',{staticClass:\"icon-style\"},[_c('span',{staticClass:\"unreadNum\"},[_vm._v(_vm._s(_vm.getUnreadNum(item)))])]):_vm._e()]),_vm._v(\" \"),_c('span',{staticClass:\"time-style\"},[_vm._v(_vm._s(_vm.getLastMsg(item).msgTime))])]),_vm._v(\" \"),_c('div',{staticClass:\"message-detail\"},[_vm._v(_vm._s(_vm.getLastMsg(item).lastMsg))])])])})],2)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-5bb79407\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/chat/messagebox.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-5bb79407\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./messagebox.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./messagebox.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./messagebox.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-5bb79407\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./messagebox.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-5bb79407\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/chat/messagebox.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}